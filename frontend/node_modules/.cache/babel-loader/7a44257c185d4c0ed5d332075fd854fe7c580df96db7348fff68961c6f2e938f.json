{"ast":null,"code":"import dayjs from \"dayjs\";\nimport { AbstractParserWithWordBoundaryChecking } from \"../../../../common/parsers/AbstractParserWithWordBoundary.js\";\nimport { WEEKDAY_OFFSET } from \"../constants.js\";\nconst PATTERN = new RegExp(\"(?<prefix>上|下|这)(?:个)?(?:星期|礼拜|周)(?<weekday>\" + Object.keys(WEEKDAY_OFFSET).join(\"|\") + \")\");\nexport default class ZHHansRelationWeekdayParser extends AbstractParserWithWordBoundaryChecking {\n  innerPattern() {\n    return PATTERN;\n  }\n  innerExtract(context, match) {\n    const result = context.createParsingResult(match.index, match[0]);\n    const dayOfWeek = match.groups.weekday;\n    const offset = WEEKDAY_OFFSET[dayOfWeek];\n    if (offset === undefined) return null;\n    let modifier = null;\n    const prefix = match.groups.prefix;\n    if (prefix == \"上\") {\n      modifier = \"last\";\n    } else if (prefix == \"下\") {\n      modifier = \"next\";\n    } else if (prefix == \"这\") {\n      modifier = \"this\";\n    }\n    let startMoment = dayjs(context.refDate);\n    let startMomentFixed = false;\n    const refOffset = startMoment.day();\n    if (modifier == \"last\" || modifier == \"past\") {\n      startMoment = startMoment.day(offset - 7);\n      startMomentFixed = true;\n    } else if (modifier == \"next\") {\n      startMoment = startMoment.day(offset + 7);\n      startMomentFixed = true;\n    } else if (modifier == \"this\") {\n      startMoment = startMoment.day(offset);\n    } else {\n      if (Math.abs(offset - 7 - refOffset) < Math.abs(offset - refOffset)) {\n        startMoment = startMoment.day(offset - 7);\n      } else if (Math.abs(offset + 7 - refOffset) < Math.abs(offset - refOffset)) {\n        startMoment = startMoment.day(offset + 7);\n      } else {\n        startMoment = startMoment.day(offset);\n      }\n    }\n    result.start.assign(\"weekday\", offset);\n    if (startMomentFixed) {\n      result.start.assign(\"day\", startMoment.date());\n      result.start.assign(\"month\", startMoment.month() + 1);\n      result.start.assign(\"year\", startMoment.year());\n    } else {\n      result.start.imply(\"day\", startMoment.date());\n      result.start.imply(\"month\", startMoment.month() + 1);\n      result.start.imply(\"year\", startMoment.year());\n    }\n    return result;\n  }\n}","map":{"version":3,"names":["dayjs","AbstractParserWithWordBoundaryChecking","WEEKDAY_OFFSET","PATTERN","RegExp","Object","keys","join","ZHHansRelationWeekdayParser","innerPattern","innerExtract","context","match","result","createParsingResult","index","dayOfWeek","groups","weekday","offset","undefined","modifier","prefix","startMoment","refDate","startMomentFixed","refOffset","day","Math","abs","start","assign","date","month","year","imply"],"sources":["/Users/mvikr/Projects/TaskApp/frontend/node_modules/chrono-node/src/locales/zh/hans/parsers/ZHHansRelationWeekdayParser.ts"],"sourcesContent":["import dayjs from \"dayjs\";\nimport { ParsingContext } from \"../../../../chrono\";\nimport { AbstractParserWithWordBoundaryChecking } from \"../../../../common/parsers/AbstractParserWithWordBoundary\";\nimport { ParsingResult } from \"../../../../results\";\nimport { WEEKDAY_OFFSET } from \"../constants\";\n\nconst PATTERN = new RegExp(\n    \"(?<prefix>上|下|这)(?:个)?(?:星期|礼拜|周)(?<weekday>\" + Object.keys(WEEKDAY_OFFSET).join(\"|\") + \")\"\n);\n\nexport default class ZHHansRelationWeekdayParser extends AbstractParserWithWordBoundaryChecking {\n    innerPattern(): RegExp {\n        return PATTERN;\n    }\n\n    innerExtract(context: ParsingContext, match: RegExpMatchArray): ParsingResult {\n        const result = context.createParsingResult(match.index, match[0]);\n\n        const dayOfWeek = match.groups.weekday;\n        const offset = WEEKDAY_OFFSET[dayOfWeek];\n        if (offset === undefined) return null;\n\n        let modifier = null;\n        const prefix = match.groups.prefix;\n\n        if (prefix == \"上\") {\n            modifier = \"last\";\n        } else if (prefix == \"下\") {\n            modifier = \"next\";\n        } else if (prefix == \"这\") {\n            modifier = \"this\";\n        }\n\n        let startMoment = dayjs(context.refDate);\n        let startMomentFixed = false;\n        const refOffset = startMoment.day();\n\n        if (modifier == \"last\" || modifier == \"past\") {\n            startMoment = startMoment.day(offset - 7);\n            startMomentFixed = true;\n        } else if (modifier == \"next\") {\n            startMoment = startMoment.day(offset + 7);\n            startMomentFixed = true;\n        } else if (modifier == \"this\") {\n            startMoment = startMoment.day(offset);\n        } else {\n            if (Math.abs(offset - 7 - refOffset) < Math.abs(offset - refOffset)) {\n                startMoment = startMoment.day(offset - 7);\n            } else if (Math.abs(offset + 7 - refOffset) < Math.abs(offset - refOffset)) {\n                startMoment = startMoment.day(offset + 7);\n            } else {\n                startMoment = startMoment.day(offset);\n            }\n        }\n\n        result.start.assign(\"weekday\", offset);\n        if (startMomentFixed) {\n            result.start.assign(\"day\", startMoment.date());\n            result.start.assign(\"month\", startMoment.month() + 1);\n            result.start.assign(\"year\", startMoment.year());\n        } else {\n            result.start.imply(\"day\", startMoment.date());\n            result.start.imply(\"month\", startMoment.month() + 1);\n            result.start.imply(\"year\", startMoment.year());\n        }\n\n        return result;\n    }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}